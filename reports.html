<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AI ë¶„ì„ ë¦¬í¬íŠ¸ â€” ì¼ë ‰ì…˜ë§µAI</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css">
<script>tailwind.config={theme:{extend:{fontFamily:{sans:['Pretendard Variable','Pretendard','system-ui','sans-serif']}}}}</script>
<link rel="stylesheet" href="css/custom.css">
</head>
<body class="antialiased bg-white text-gray-900">
<div id="test-banner"></div>
<div id="app-header"></div>

<!-- Page Header -->
<section class="bg-gradient-to-br from-rose-50 via-white to-white py-12 border-b border-gray-100">
<div class="max-w-7xl mx-auto px-6">
<div class="flex items-center gap-3 mb-4">
<div class="w-12 h-12 bg-rose-100 rounded-xl flex items-center justify-center text-2xl">ğŸ“Š</div>
<div>
<h1 class="text-3xl font-bold">AI ë¶„ì„ ë¦¬í¬íŠ¸</h1>
<p class="text-gray-500 mt-1">ì„ ê±°êµ¬ ë°ì´í„° ê¸°ë°˜ ì¢…í•© ì „ëµ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤</p>
</div>
</div>
</div>
</section>

<div class="max-w-7xl mx-auto px-6 py-10">

<!-- Report Generation Form -->
<div class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm mb-10 no-print">
<h2 class="text-xl font-bold mb-6">ë¦¬í¬íŠ¸ ìƒì„±</h2>
<div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-1">ì„ ê±° ìœ í˜•</label>
<select id="rptElectionType" class="w-full border border-gray-300 rounded-lg px-4 py-2.5">
</select>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-1">ì„ ê±°êµ¬</label>
<select id="rptDistrict" class="w-full border border-gray-300 rounded-lg px-4 py-2.5">
</select>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-1">ì˜ˆì‚° (ë§Œì›)</label>
<input type="number" id="rptBudget" value="5000" min="100" class="w-full border border-gray-300 rounded-lg px-4 py-2.5">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-1">ì°¨ëŸ‰ ìˆ˜</label>
<input type="number" id="rptVehicles" value="2" min="1" max="5" class="w-full border border-gray-300 rounded-lg px-4 py-2.5">
</div>
</div>
<div class="mt-6 flex justify-end">
<button onclick="generateReport()" class="flex items-center gap-2 bg-gradient-to-r from-rose-600 to-blue-600 text-white px-8 py-3 rounded-xl font-semibold hover:shadow-lg transition">
<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
ë¦¬í¬íŠ¸ ìƒì„±
</button>
</div>
</div>

<!-- Generated Report -->
<div id="reportOutput" class="hidden space-y-8">

<!-- Print button -->
<div class="flex justify-end no-print">
<button onclick="window.print()" class="flex items-center gap-2 bg-gray-100 text-gray-700 px-5 py-2.5 rounded-xl font-semibold hover:bg-gray-200 transition">
<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>
ì¸ì‡„í•˜ê¸°
</button>
</div>

<!-- Report Header -->
<div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-2xl p-8 text-white">
<div class="flex items-start justify-between">
<div>
<div class="flex items-center gap-2 mb-2">
<div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></div>
<span class="text-blue-200 text-sm font-medium">ì¼ë ‰ì…˜ë§µAI ë¶„ì„ ë¦¬í¬íŠ¸</span>
</div>
<h2 class="text-3xl font-bold" id="rptTitle"></h2>
<p class="text-blue-200 mt-2" id="rptSubtitle"></p>
</div>
<div class="text-right">
<p class="text-blue-200 text-sm">ìƒì„±ì¼</p>
<p class="font-bold" id="rptDate"></p>
</div>
</div>
</div>

<!-- ì¢…í•© ì ìˆ˜ -->
<div class="bg-white rounded-2xl border border-gray-200 p-8 shadow-sm">
<h3 class="text-xl font-bold mb-6 flex items-center gap-2">
<svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>
ì¢…í•© ì ìˆ˜
</h3>
<div class="grid md:grid-cols-2 gap-8 items-center">
<div class="text-center">
<div class="inline-flex items-center justify-center w-40 h-40 rounded-full border-8" id="scoreCircle">
<div>
<p class="text-5xl font-bold" id="totalScore"></p>
<p class="text-sm text-gray-500 mt-1">/ 100ì </p>
</div>
</div>
<div class="mt-4" id="gradeBadge"></div>
</div>
<div class="h-72"><canvas id="radarChart"></canvas></div>
</div>
</div>

<!-- ìœ ê¶Œì ë¶„ì„ -->
<div class="bg-white rounded-2xl border border-gray-200 p-8 shadow-sm">
<h3 class="text-xl font-bold mb-6 flex items-center gap-2">
<svg class="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
ìœ ê¶Œì ë¶„ì„
</h3>
<div class="grid md:grid-cols-4 gap-4 mb-6" id="voterStats"></div>
<div class="grid md:grid-cols-2 gap-8">
<div>
<h4 class="font-semibold text-gray-700 mb-3">ì—°ë ¹ëŒ€ë³„ ìœ ê¶Œì ë¶„í¬</h4>
<div class="h-64"><canvas id="ageChart"></canvas></div>
</div>
<div>
<h4 class="font-semibold text-gray-700 mb-3">í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h4>
<div id="voterInsights" class="space-y-3"></div>
</div>
</div>
</div>

<!-- ê²½ë¡œ ì „ëµ ìš”ì•½ -->
<div class="bg-white rounded-2xl border border-gray-200 p-8 shadow-sm print-break">
<h3 class="text-xl font-bold mb-6 flex items-center gap-2">
<svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/></svg>
ê²½ë¡œ ì „ëµ ìš”ì•½
</h3>
<div id="routeStrategy"></div>
</div>

<!-- ë¹„ìš© ì˜ˆì¸¡ -->
<div class="bg-white rounded-2xl border border-gray-200 p-8 shadow-sm">
<h3 class="text-xl font-bold mb-6 flex items-center gap-2">
<svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
ë¹„ìš© ì˜ˆì¸¡
</h3>
<div id="costPrediction"></div>
</div>

<!-- ê²½ìŸ ë¶„ì„ -->
<div class="bg-white rounded-2xl border border-gray-200 p-8 shadow-sm">
<h3 class="text-xl font-bold mb-6 flex items-center gap-2">
<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
ê²½ìŸ ë¶„ì„
</h3>
<div id="competitorAnalysis"></div>
</div>

<!-- AI ì „ëµ ì¶”ì²œ -->
<div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl border border-purple-200 p-8">
<h3 class="text-xl font-bold mb-6 flex items-center gap-2">
<svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
AI ì „ëµ ì¶”ì²œ
</h3>
<div id="aiRecommendations" class="space-y-4"></div>
</div>

</div>
</div>

<div id="app-footer"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="js/mock-data.js"></script>
<script src="js/shared.js"></script>
<script src="js/chart-helpers.js"></script>
<script>
initPage('reports');

let radarChartInstance = null;
let ageChartInstance = null;

// Populate dropdowns
const elTypeSelect = document.getElementById('rptElectionType');
ELECTION_TYPES.forEach(e => {
  const opt = document.createElement('option');
  opt.value = e.id;
  opt.textContent = e.name;
  elTypeSelect.appendChild(opt);
});
elTypeSelect.value = 'basic_head';

const distSelect = document.getElementById('rptDistrict');
DISTRICTS.forEach(d => {
  const opt = document.createElement('option');
  opt.value = d.code;
  opt.textContent = `${d.sigungu} ${d.dong}`;
  distSelect.appendChild(opt);
});

function generateReport() {
  const typeId = document.getElementById('rptElectionType').value;
  const distCode = document.getElementById('rptDistrict').value;
  const budget = parseInt(document.getElementById('rptBudget').value) || 5000;
  const vehicles = parseInt(document.getElementById('rptVehicles').value) || 2;

  const elType = getElectionType(typeId);
  const district = findDistrict(distCode);
  if (!district) { alert('ì„ ê±°êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.'); return; }

  const spots = getSpotsForDistrict(district.dong);
  const scores = district.scores;

  // Show report
  document.getElementById('reportOutput').classList.remove('hidden');

  // Header
  document.getElementById('rptTitle').textContent = `${district.sigungu} ${district.dong} ${elType.name} ì „ëµ ë¶„ì„`;
  document.getElementById('rptSubtitle').textContent = `ì„ ê±°êµ¬ ì½”ë“œ: ${district.code} | ì˜ˆì‚°: ${fmt(budget)}ë§Œì› | ì°¨ëŸ‰: ${vehicles}ëŒ€`;
  const now = new Date();
  document.getElementById('rptDate').textContent = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')}`;

  // Total Score
  const totalScore = scores.total;
  const grade = getGrade(totalScore);
  document.getElementById('totalScore').textContent = totalScore;
  const scoreColor = totalScore >= 80 ? 'border-blue-400 text-blue-600' : totalScore >= 70 ? 'border-green-400 text-green-600' : totalScore >= 60 ? 'border-yellow-400 text-yellow-600' : 'border-red-400 text-red-600';
  document.getElementById('scoreCircle').className = `inline-flex items-center justify-center w-40 h-40 rounded-full border-8 ${scoreColor}`;
  document.getElementById('gradeBadge').innerHTML = gradeBadgeHTML(grade);

  // Radar chart
  if (radarChartInstance) radarChartInstance.destroy();
  const radarCtx = document.getElementById('radarChart').getContext('2d');
  radarChartInstance = createRadarChart(
    radarCtx,
    ['ìœ ê¶Œì ë°€ì§‘ë„', 'ì ‘ê·¼ì„±', 'ë¹„ìš© íš¨ìœ¨', 'ì»¤ë²„ë¦¬ì§€', 'ê²½ìŸ ìš°ìœ„'],
    [scores.voter_density, scores.accessibility, scores.cost_efficiency, scores.coverage, scores.competition]
  );

  // Voter stats
  document.getElementById('voterStats').innerHTML = [
    { label: 'ì´ ì¸êµ¬', value: fmt(district.population) + 'ëª…', color: 'blue' },
    { label: 'ìœ ê¶Œì ìˆ˜', value: fmt(district.voters) + 'ëª…', color: 'emerald' },
    { label: 'ìœ ë™ì¸êµ¬', value: fmt(district.floating_pop) + 'ëª…', color: 'amber' },
    { label: 'ê³¼ê±° íˆ¬í‘œìœ¨', value: district.past_turnout + '%', color: 'purple' }
  ].map(s => `<div class="bg-${s.color}-50 rounded-xl p-4 text-center">
    <p class="text-sm text-gray-500">${s.label}</p>
    <p class="text-xl font-bold text-${s.color}-600 mt-1">${s.value}</p>
  </div>`).join('');

  // Age chart
  if (ageChartInstance) ageChartInstance.destroy();
  const ageCtx = document.getElementById('ageChart').getContext('2d');
  ageChartInstance = createBarChart(ageCtx,
    ['20ëŒ€', '30ëŒ€', '40ëŒ€', '50ëŒ€', '60ëŒ€+'],
    [{
      label: 'ìœ ê¶Œì ë¹„ìœ¨ (%)',
      data: [district.age_20s_pct, district.age_30s_pct, district.age_40s_pct, district.age_50s_pct, district.age_60plus_pct],
      color: ['rgba(37,99,235,0.6)', 'rgba(59,130,246,0.6)', 'rgba(96,165,250,0.6)', 'rgba(147,197,253,0.6)', 'rgba(191,219,254,0.6)'],
      borderColor: ['#2563eb', '#3b82f6', '#60a5fa', '#93c5fd', '#bfdbfe']
    }]
  );

  // Voter insights
  const ageData = [
    { label: '20ëŒ€', pct: district.age_20s_pct },
    { label: '30ëŒ€', pct: district.age_30s_pct },
    { label: '40ëŒ€', pct: district.age_40s_pct },
    { label: '50ëŒ€', pct: district.age_50s_pct },
    { label: '60ëŒ€+', pct: district.age_60plus_pct }
  ];
  const maxAge = ageData.reduce((a, b) => a.pct > b.pct ? a : b);
  const minAge = ageData.reduce((a, b) => a.pct < b.pct ? a : b);
  const estimatedTurnoutVoters = Math.round(district.voters * district.past_turnout / 100);

  const insights = [
    { icon: 'ğŸ“Š', text: `${maxAge.label} ìœ ê¶Œì ë¹„ìœ¨ì´ ${maxAge.pct}%ë¡œ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤. ì´ ì—°ë ¹ì¸µì„ íƒ€ê²Ÿìœ¼ë¡œ í•œ ë§ì¶¤ ë©”ì‹œì§€ê°€ íš¨ê³¼ì ì…ë‹ˆë‹¤.` },
    { icon: 'ğŸ¯', text: `ê³¼ê±° íˆ¬í‘œìœ¨ ${district.past_turnout}% ê¸°ì¤€, ì˜ˆìƒ ì‹¤íˆ¬í‘œ ìœ ê¶ŒìëŠ” ì•½ ${fmt(estimatedTurnoutVoters)}ëª…ì…ë‹ˆë‹¤.` },
    { icon: 'ğŸƒ', text: `ìœ ë™ì¸êµ¬ ${fmt(district.floating_pop)}ëª…ìœ¼ë¡œ ${district.floating_pop > 90000 ? 'ë†’ì€ ìˆ˜ì¤€' : 'ë³´í†µ ìˆ˜ì¤€'}ì…ë‹ˆë‹¤. ${district.floating_pop > 90000 ? 'ì—­ì„¸ê¶Œ/ìƒê°€ ì¤‘ì‹¬ ìœ ì„¸ê°€ íš¨ê³¼ì ì…ë‹ˆë‹¤.' : 'ì£¼ê±°ì§€ì—­ ì¤‘ì‹¬ ìœ ì„¸ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.'}` },
    { icon: 'ğŸ“ˆ', text: `${minAge.label} ìœ ê¶Œì ë¹„ìœ¨ì´ ${minAge.pct}%ë¡œ ê°€ì¥ ë‚®ì•„, ${minAge.label === '20ëŒ€' || minAge.label === '30ëŒ€' ? 'SNS/ì˜¨ë¼ì¸ ìº í˜ì¸ ë³‘í–‰' : 'ì „í†µì  í™ë³´ ë§¤ì²´ í™œìš©'}ì„ ê³ ë ¤í•˜ì„¸ìš”.` }
  ];

  document.getElementById('voterInsights').innerHTML = insights.map(i =>
    `<div class="flex items-start gap-3 bg-white rounded-xl p-4 border border-gray-100">
      <span class="text-xl shrink-0">${i.icon}</span>
      <p class="text-sm text-gray-700 leading-relaxed">${i.text}</p>
    </div>`
  ).join('');

  // Route Strategy
  const topSpots = spots.sort((a, b) => b.voterReach - a.voterReach).slice(0, 5);
  const totalDailyReach = topSpots.reduce((a, b) => a + b.voterReach, 0);
  const spotsPerVehicle = Math.ceil(topSpots.length / vehicles);

  document.getElementById('routeStrategy').innerHTML = `
    <div class="grid md:grid-cols-3 gap-4 mb-6">
      <div class="bg-blue-50 rounded-xl p-4 text-center">
        <p class="text-sm text-gray-500">ì¶”ì²œ ì°¨ëŸ‰ ìˆ˜</p>
        <p class="text-2xl font-bold text-blue-600">${vehicles}ëŒ€</p>
      </div>
      <div class="bg-emerald-50 rounded-xl p-4 text-center">
        <p class="text-sm text-gray-500">ì¼ì¼ ì˜ˆìƒ ì ‘ì´‰</p>
        <p class="text-2xl font-bold text-emerald-600">${fmt(totalDailyReach)}ëª…</p>
      </div>
      <div class="bg-amber-50 rounded-xl p-4 text-center">
        <p class="text-sm text-gray-500">ê±°ì ë‹¹ ì°¨ëŸ‰ ë°°ë¶„</p>
        <p class="text-2xl font-bold text-amber-600">${spotsPerVehicle}ê³³/ëŒ€</p>
      </div>
    </div>
    <h4 class="font-semibold text-gray-700 mb-3">TOP 5 ìœ ì„¸ ê±°ì  (ìœ ê¶Œì ì ‘ì´‰ ìˆœ)</h4>
    <div class="overflow-x-auto">
      <table class="data-table">
        <thead><tr><th>ìˆœìœ„</th><th>ê±°ì </th><th>ìœ í˜•</th><th>í”¼í¬ ì‹œê°„</th><th class="text-right">ìœ ê¶Œì ì ‘ì´‰</th><th class="text-right">ì¼ì¼ ë¹„ìš©</th></tr></thead>
        <tbody>
          ${topSpots.map((s, i) => `<tr>
            <td><span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-blue-600 text-white text-sm font-bold">${i + 1}</span></td>
            <td class="font-medium">${s.name}</td>
            <td><span class="text-xs px-2 py-1 bg-gray-100 rounded-full">${s.type}</span></td>
            <td>${s.peakHour}</td>
            <td class="text-right font-semibold text-blue-600">${fmt(s.voterReach)}ëª…</td>
            <td class="text-right">${fmt(s.dailyCost)}ì›</td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>
  `;

  // Cost Prediction
  const dailyItems = ['vehicleRental', 'fuel', 'driver', 'sound', 'assistant', 'parking', 'insurance'];
  let dailyCostPerVehicle = 0;
  dailyItems.forEach(k => { dailyCostPerVehicle += COST_TABLE[k].daily; });
  const dailyCost = dailyCostPerVehicle * vehicles;
  const bannerCost = COST_TABLE.banner.once * vehicles;
  const period = parseInt(elType.period) || 14;
  const totalCost = dailyCost * period + bannerCost;
  const budgetWon = budget * 10000;
  const budgetUtilPct = ((totalCost / budgetWon) * 100).toFixed(1);
  const costEffGrade = budgetUtilPct <= 60 ? 'A' : budgetUtilPct <= 80 ? 'B' : budgetUtilPct <= 100 ? 'C' : 'D';

  document.getElementById('costPrediction').innerHTML = `
    <div class="grid md:grid-cols-4 gap-4 mb-6">
      <div class="bg-gray-50 rounded-xl p-4 text-center">
        <p class="text-sm text-gray-500">ì¼ì¼ ë¹„ìš©</p>
        <p class="text-xl font-bold">${fmtWon(dailyCost)}</p>
      </div>
      <div class="bg-gray-50 rounded-xl p-4 text-center">
        <p class="text-sm text-gray-500">ì´ ë¹„ìš© (${period}ì¼)</p>
        <p class="text-xl font-bold text-blue-600">${fmtWon(totalCost)}</p>
      </div>
      <div class="bg-gray-50 rounded-xl p-4 text-center">
        <p class="text-sm text-gray-500">ì˜ˆì‚° í™œìš©ë¥ </p>
        <p class="text-xl font-bold ${budgetUtilPct > 100 ? 'text-red-600' : budgetUtilPct > 80 ? 'text-amber-600' : 'text-emerald-600'}">${budgetUtilPct}%</p>
      </div>
      <div class="bg-gray-50 rounded-xl p-4 text-center">
        <p class="text-sm text-gray-500">ë¹„ìš© íš¨ìœ¨ ë“±ê¸‰</p>
        <p class="text-xl font-bold">${gradeBadgeHTML(costEffGrade)}</p>
      </div>
    </div>
    <div class="mb-2 flex justify-between text-sm text-gray-600">
      <span>ë¹„ìš©: ${fmtWon(totalCost)}</span>
      <span>ì˜ˆì‚°: ${fmtWon(budgetWon)}</span>
    </div>
    <div class="w-full h-4 bg-gray-200 rounded-full overflow-hidden">
      <div class="h-full rounded-full transition-all duration-500 ${budgetUtilPct > 100 ? 'bg-red-500' : budgetUtilPct > 80 ? 'bg-amber-500' : 'bg-blue-500'}" style="width:${Math.min(100, budgetUtilPct)}%"></div>
    </div>
    ${budgetUtilPct > 100 ? '<p class="mt-2 text-sm text-red-600 font-medium">* ì˜ˆì‚°ì„ ì´ˆê³¼í•©ë‹ˆë‹¤. ì°¨ëŸ‰ ìˆ˜ ë˜ëŠ” ìš´ì˜ ê¸°ê°„ì„ ì¡°ì •í•˜ì„¸ìš”.</p>' : `<p class="mt-2 text-sm text-gray-500">* ì”ì—¬ ì˜ˆì‚°: ${fmtWon(Math.max(0, budgetWon - totalCost))}</p>`}
  `;

  // Competitor Analysis
  const distCompetitors = COMPETITORS.filter(c => c.mainAreas.some(a => district.dong.includes(a) || a.includes(district.dong)));
  const allCompetitors = distCompetitors.length > 0 ? distCompetitors : COMPETITORS;
  const competitorAreas = new Set();
  allCompetitors.forEach(c => c.mainAreas.forEach(a => competitorAreas.add(a)));
  const allDistricts = DISTRICTS.map(d => d.dong);
  const gapAreas = allDistricts.filter(d => !competitorAreas.has(d)).slice(0, 3);

  document.getElementById('competitorAnalysis').innerHTML = `
    <div class="grid md:grid-cols-2 gap-4 mb-6">
      <div class="bg-red-50 rounded-xl p-4 text-center">
        <p class="text-sm text-gray-500">ê²½ìŸ í›„ë³´ ìˆ˜</p>
        <p class="text-2xl font-bold text-red-600">${district.competitors}ëª…</p>
      </div>
      <div class="bg-green-50 rounded-xl p-4 text-center">
        <p class="text-sm text-gray-500">ë°œê²¬ëœ ê³µë°± ì§€ì—­</p>
        <p class="text-2xl font-bold text-green-600">${gapAreas.length}ê³³</p>
      </div>
    </div>
    <h4 class="font-semibold text-gray-700 mb-3">ê²½ìŸ í›„ë³´ í˜„í™©</h4>
    <div class="grid md:grid-cols-${Math.min(3, allCompetitors.length)} gap-4 mb-6">
      ${allCompetitors.map(c => `<div class="border rounded-xl p-4" style="border-left:4px solid ${c.color}">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold" style="background:${c.color}">${c.name[0]}</div>
          <div>
            <p class="font-bold text-sm">${c.name}</p>
            <p class="text-xs text-gray-500">${c.party}</p>
          </div>
        </div>
        <p class="text-xs text-gray-600 mt-1"><strong>ê°•ì :</strong> ${c.strength.join(', ')}</p>
        <p class="text-xs text-gray-600"><strong>ì•½ì :</strong> ${c.weakness.join(', ')}</p>
        <p class="text-xs text-gray-600"><strong>ì£¼ìš”ì§€ì—­:</strong> ${c.mainAreas.join(', ')}</p>
      </div>`).join('')}
    </div>
    ${gapAreas.length > 0 ? `<div class="bg-green-50 rounded-xl p-4 border border-green-200">
      <h4 class="font-semibold text-green-800 mb-2">ê³µë°± ì§€ì—­ ì¶”ì²œ</h4>
      <p class="text-sm text-green-700">ê²½ìŸ í›„ë³´ê°€ ì§‘ì¤‘í•˜ì§€ ì•ŠëŠ” ë‹¤ìŒ ì§€ì—­ì„ ê³µëµí•˜ì„¸ìš”: <strong>${gapAreas.join(', ')}</strong></p>
    </div>` : ''}
  `;

  // AI Recommendations
  const recommendations = [];

  if (scores.voter_density >= 80) {
    recommendations.push({ icon: 'ğŸ¯', text: `ìœ ê¶Œì ë°€ì§‘ë„ê°€ ë†’ì€ ${district.dong}ë¥¼ ìµœìš°ì„  ê³µëµí•˜ì„¸ìš”. ë°€ì§‘ ì§€ì—­ì—ì„œì˜ ìœ ì„¸ íš¨ìœ¨ì´ ê·¹ëŒ€í™”ë©ë‹ˆë‹¤.` });
  } else {
    recommendations.push({ icon: 'ğŸ“', text: `${district.dong}ì˜ ìœ ê¶Œì ë°€ì§‘ë„(${scores.voter_density}ì )ê°€ í‰ê·  ìˆ˜ì¤€ì…ë‹ˆë‹¤. ìœ ë™ì¸êµ¬ê°€ ë§ì€ ì—­ì„¸ê¶Œê³¼ ì‹œì¥ì„ ì¤‘ì‹¬ìœ¼ë¡œ ìœ ì„¸í•˜ì„¸ìš”.` });
  }

  if (scores.competition < 60) {
    recommendations.push({ icon: 'âš”ï¸', text: `ê²½ìŸì´ ì¹˜ì—´í•œ ì§€ì—­(${scores.competition}ì )ì…ë‹ˆë‹¤. ì°¨ë³„í™”ëœ ìœ ì„¸ ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤. ê²½ìŸìê°€ ë†“ì¹˜ëŠ” ì‹œê°„ëŒ€(ì´ë¥¸ ì•„ì¹¨, ì ì‹¬ì‹œê°„)ë¥¼ ê³µëµí•˜ì„¸ìš”.` });
  } else {
    recommendations.push({ icon: 'ğŸ›¡ï¸', text: `ê²½ìŸ ìš°ìœ„(${scores.competition}ì )ê°€ ìˆëŠ” í¸ì…ë‹ˆë‹¤. í˜„ì¬ ìš°ìœ„ë¥¼ ìœ ì§€í•˜ë©´ì„œ ì•½ì  ì§€ì—­ì„ ë³´ì™„í•˜ì„¸ìš”.` });
  }

  if (maxAge.label === '20ëŒ€' || maxAge.label === '30ëŒ€') {
    recommendations.push({ icon: 'ğŸ“±', text: `${maxAge.label} ë¹„ìœ¨ì´ ë†’ìŠµë‹ˆë‹¤. ì°¨ëŸ‰ ìœ ì„¸ì™€ í•¨ê»˜ SNS/ìˆí¼ ì½˜í…ì¸ ë¥¼ ë³‘í–‰í•˜ì—¬ ì Šì€ ìœ ê¶Œìë¥¼ ê³µëµí•˜ì„¸ìš”.` });
  } else {
    recommendations.push({ icon: 'ğŸ“¢', text: `${maxAge.label} ìœ ê¶Œìê°€ ì¤‘ì‹¬ì¸µì…ë‹ˆë‹¤. ì „í†µì ì¸ ì°¨ëŸ‰ ìœ ì„¸ì™€ í˜„ì¥ ì ‘ì´‰ì„ ê°•í™”í•˜ì„¸ìš”.` });
  }

  if (budgetUtilPct > 80) {
    recommendations.push({ icon: 'ğŸ’°', text: `ì˜ˆì‚° í™œìš©ë¥ ì´ ${budgetUtilPct}%ë¡œ ë†’ìŠµë‹ˆë‹¤. ì‹œê°„ëŒ€ ìµœì í™”(í”¼í¬íƒ€ì„ ì§‘ì¤‘ ìš´ì˜)ë¡œ ë¹„ìš©ì„ ì ˆê°í•˜ì„¸ìš”. ì˜ˆìƒ ì ˆê°ë¥ : 15~25%` });
  } else {
    recommendations.push({ icon: 'ğŸ“ˆ', text: `ì˜ˆì‚° ì—¬ìœ (ì”ì—¬ ${(100 - budgetUtilPct).toFixed(0)}%)ê°€ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ ì°¨ëŸ‰ íˆ¬ì…ì´ë‚˜ ìœ ì„¸ ê¸°ê°„ ì—°ì¥ì„ ê²€í† í•˜ì„¸ìš”.` });
  }

  recommendations.push({ icon: 'ğŸ•', text: `TIME_PATTERNS ë¶„ì„ ê²°ê³¼, ì—­ì„¸ê¶Œì€ 08~09ì‹œ, ì‹œì¥ì€ 09~11ì‹œ, ì•„íŒŒíŠ¸ë‹¨ì§€ëŠ” 18~20ì‹œê°€ ìµœì  ìœ ì„¸ ì‹œê°„ì…ë‹ˆë‹¤. ì´ ì‹œê°„ëŒ€ì— ì§‘ì¤‘í•˜ì„¸ìš”.` });

  document.getElementById('aiRecommendations').innerHTML = recommendations.map(r =>
    `<div class="flex items-start gap-4 bg-white rounded-xl p-5 border border-purple-100 shadow-sm">
      <span class="text-2xl shrink-0">${r.icon}</span>
      <p class="text-gray-700 leading-relaxed">${r.text}</p>
    </div>`
  ).join('');

  // Scroll to report
  document.getElementById('reportOutput').scrollIntoView({ behavior: 'smooth', block: 'start' });
}
</script>
</body>
</html>
