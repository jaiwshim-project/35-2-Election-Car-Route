<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>경쟁 후보 분석 — 일렉션맵AI</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css">
<script>tailwind.config={theme:{extend:{fontFamily:{sans:['Pretendard Variable','Pretendard','system-ui','sans-serif']}}}}</script>
<link rel="stylesheet" href="css/custom.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  .party-badge { display: inline-flex; align-items: center; gap: 6px; padding: 3px 10px; border-radius: 9999px; font-size: 12px; font-weight: 600; }
  .strength-badge { display: inline-block; padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; background: #dbeafe; color: #1e40af; }
  .weakness-badge { display: inline-block; padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; background: #fee2e2; color: #991b1b; }
  .competitor-card { border: 2px solid #e2e8f0; border-radius: 16px; padding: 16px; cursor: pointer; transition: all 0.2s; }
  .competitor-card:hover { border-color: #93c5fd; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
  .competitor-card.active { border-color: #2563eb; background: #eff6ff; }
  .strategy-card { background: linear-gradient(135deg, #eff6ff 0%, #f0fdf4 100%); border: 1px solid #bfdbfe; border-radius: 12px; padding: 16px; }
</style>
</head>
<body class="antialiased bg-gray-50 text-gray-900">
<div id="test-banner"></div>
<div id="app-header"></div>

<main class="max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-6">
  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">경쟁 후보 분석</h1>
      <p class="text-sm text-gray-500 mt-1">경쟁 후보의 유세 전략을 분석하고 공백 지역을 발견하세요</p>
    </div>
    <div class="flex items-center gap-2">
      <select id="district-filter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm bg-white" onchange="onDistrictFilterChange()">
        <option value="">전체 지역</option>
      </select>
    </div>
  </div>

  <!-- Top Section: Competitors + Map -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Left: Competitor List -->
    <div class="space-y-4">
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
        <h3 class="font-bold text-gray-800 mb-4">후보 목록</h3>
        <div id="competitor-list" class="space-y-3"></div>
      </div>

      <!-- Add Competitor Form -->
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
        <h3 class="font-bold text-gray-800 mb-4">후보 추가</h3>
        <form id="add-form" onsubmit="addCompetitor(event)" class="space-y-3">
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-1">이름</label>
            <input type="text" id="new-name" required class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500" placeholder="후보 이름">
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-1">정당</label>
            <select id="new-party" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm bg-white">
              <option value="더불어민주당">더불어민주당</option>
              <option value="국민의힘">국민의힘</option>
              <option value="정의당">정의당</option>
              <option value="무소속">무소속</option>
              <option value="기타">기타</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-1">주요 활동 지역</label>
            <select id="new-district" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm bg-white">
            </select>
          </div>
          <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2.5 rounded-xl hover:bg-blue-700 transition text-sm">후보 추가</button>
        </form>
      </div>
    </div>

    <!-- Right: Map -->
    <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
      <div class="px-5 py-4 border-b border-gray-100 flex items-center justify-between">
        <h3 class="font-bold text-gray-800">경쟁 후보 활동 영역</h3>
        <div class="flex items-center gap-3 text-xs">
          <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-green-500 inline-block opacity-50"></span> 공백 지역</span>
          <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-red-500 inline-block opacity-50"></span> 경쟁 과열</span>
        </div>
      </div>
      <div id="competitor-map" style="height:500px;"></div>
    </div>
  </div>

  <!-- Bottom Section: Charts + Strategy -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Radar Comparison -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
      <div class="px-5 py-4 border-b border-gray-100">
        <h3 class="font-bold text-gray-800">후보 역량 비교</h3>
        <p class="text-xs text-gray-500 mt-0.5">5개 주요 역량 지표 비교</p>
      </div>
      <div class="p-5" style="height: 340px;">
        <canvas id="compare-radar"></canvas>
      </div>
    </div>

    <!-- Time Analysis -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
      <div class="px-5 py-4 border-b border-gray-100">
        <h3 class="font-bold text-gray-800">시간대별 유세 활동</h3>
        <p class="text-xs text-gray-500 mt-0.5">후보별 유세 활동 패턴 예측</p>
      </div>
      <div class="p-5" style="height: 340px;">
        <canvas id="time-chart"></canvas>
      </div>
    </div>

    <!-- Strategy Recommendations -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
      <div class="px-5 py-4 border-b border-gray-100">
        <h3 class="font-bold text-gray-800">AI 전략 추천</h3>
        <p class="text-xs text-gray-500 mt-0.5">경쟁 분석 기반 맞춤 전략</p>
      </div>
      <div class="p-5 space-y-3" id="strategy-panel">
      </div>
    </div>
  </div>
</main>

<div id="app-footer"></div>

<script src="js/mock-data.js"></script>
<script src="js/shared.js"></script>
<script src="js/chart-helpers.js"></script>
<script src="js/map-engine.js"></script>
<script>
initPage('competitor');

/* ── 상태 ── */
var competitorMap, compareRadarChart, timeChart;
var competitors = JSON.parse(JSON.stringify(COMPETITORS)); // 깊은 복사
var selectedCompetitorId = null;
var mapLayers = [];

/* ── 정당 색상 ── */
var partyColorMap = {
  '더불어민주당': { color: '#1a73e8', bg: 'rgba(26,115,232,0.15)', text: 'text-blue-700', bgClass: 'bg-blue-100' },
  '국민의힘': { color: '#e8361a', bg: 'rgba(232,54,26,0.15)', text: 'text-red-700', bgClass: 'bg-red-100' },
  '정의당': { color: '#f5c518', bg: 'rgba(245,197,24,0.15)', text: 'text-yellow-700', bgClass: 'bg-yellow-100' },
  '무소속': { color: '#6b7280', bg: 'rgba(107,114,128,0.15)', text: 'text-gray-700', bgClass: 'bg-gray-100' },
  '기타': { color: '#8b5cf6', bg: 'rgba(139,92,246,0.15)', text: 'text-purple-700', bgClass: 'bg-purple-100' }
};

function getPartyColor(party) {
  return partyColorMap[party] || partyColorMap['기타'];
}

/* ── 선거구 -> 좌표 매핑 ── */
function getAreaCenter(areaName) {
  var d = DISTRICTS.find(function(dd) { return dd.dong === areaName; });
  if (d) return { lat: d.lat, lng: d.lng };
  // CAMPAIGN_SPOTS 에서 검색
  var s = CAMPAIGN_SPOTS.find(function(ss) { return ss.district === areaName; });
  if (s) return { lat: s.lat, lng: s.lng };
  return { lat: 37.2636 + (Math.random() - 0.5) * 0.04, lng: 127.0286 + (Math.random() - 0.5) * 0.04 };
}

/* ── 초기화 ── */
(function init() {
  // 선거구 드롭다운
  var dFilter = document.getElementById('district-filter');
  var newDist = document.getElementById('new-district');
  DISTRICTS.forEach(function(d) {
    var opt1 = document.createElement('option');
    opt1.value = d.dong;
    opt1.textContent = d.sigungu + ' ' + d.dong;
    dFilter.appendChild(opt1);

    var opt2 = document.createElement('option');
    opt2.value = d.dong;
    opt2.textContent = d.sigungu + ' ' + d.dong;
    newDist.appendChild(opt2);
  });

  // 지도 초기화
  competitorMap = initMap('competitor-map', [37.2636, 127.0286], 12);

  // 렌더링
  renderCompetitorList();
  updateMap();
  updateCompareRadar();
  updateTimeChart();
  updateStrategy();
})();

/* ── 선거구 필터 변경 ── */
function onDistrictFilterChange() {
  renderCompetitorList();
  updateMap();
  updateStrategy();
}

/* ── 후보 목록 렌더링 ── */
function renderCompetitorList() {
  var filter = document.getElementById('district-filter').value;
  var filtered = competitors;
  if (filter) {
    filtered = competitors.filter(function(c) {
      return c.mainAreas && c.mainAreas.indexOf(filter) >= 0;
    });
  }

  document.getElementById('competitor-list').innerHTML = filtered.map(function(c) {
    var pc = getPartyColor(c.party);
    var isActive = selectedCompetitorId === c.id;

    return '<div class="competitor-card ' + (isActive ? 'active' : '') + '" onclick="selectCompetitor(' + c.id + ')">' +
      '<div class="flex items-center justify-between mb-2">' +
      '<span class="font-bold text-base">' + c.name + '</span>' +
      '<span class="party-badge ' + pc.bgClass + ' ' + pc.text + '">' +
      '<span class="w-2 h-2 rounded-full inline-block" style="background:' + pc.color + '"></span>' +
      c.party + '</span>' +
      '</div>' +
      '<p class="text-xs text-gray-500 mb-2">출마: ' + c.district + ' | 주요 활동: ' + (c.mainAreas ? c.mainAreas.join(', ') : '-') + '</p>' +
      '<div class="flex flex-wrap gap-1 mb-1">' +
      (c.strength ? c.strength.map(function(s) { return '<span class="strength-badge">' + s + '</span>'; }).join('') : '') +
      '</div>' +
      '<div class="flex flex-wrap gap-1">' +
      (c.weakness ? c.weakness.map(function(w) { return '<span class="weakness-badge">' + w + '</span>'; }).join('') : '') +
      '</div>' +
      '</div>';
  }).join('');

  if (filtered.length === 0) {
    document.getElementById('competitor-list').innerHTML =
      '<p class="text-sm text-gray-400 text-center py-6">해당 지역의 후보가 없습니다.</p>';
  }
}

/* ── 후보 선택 ── */
function selectCompetitor(id) {
  selectedCompetitorId = (selectedCompetitorId === id) ? null : id;
  renderCompetitorList();
  updateMap();
}

/* ── 후보 추가 ── */
function addCompetitor(e) {
  e.preventDefault();
  var name = document.getElementById('new-name').value.trim();
  var party = document.getElementById('new-party').value;
  var district = document.getElementById('new-district').value;

  if (!name) return;

  var pc = getPartyColor(party);
  var newComp = {
    id: competitors.length + 100,
    name: name,
    party: party,
    color: pc.color,
    district: district || '수원시장',
    strength: ['신규'],
    weakness: ['분석 중'],
    mainAreas: district ? [district] : ['장안구']
  };

  competitors.push(newComp);

  // 폼 초기화
  document.getElementById('new-name').value = '';
  document.getElementById('new-party').selectedIndex = 0;

  renderCompetitorList();
  updateMap();
  updateCompareRadar();
  updateTimeChart();
  updateStrategy();
}

/* ── 지도 업데이트 ── */
function updateMap() {
  // 기존 레이어 제거
  mapLayers.forEach(function(l) { competitorMap.removeLayer(l); });
  mapLayers = [];

  // 모든 선거구 (공백 지역 판별용)
  var allAreas = DISTRICTS.filter(function(d) {
    return ['장안구', '권선구', '팔달구', '영통구'].indexOf(d.dong) >= 0;
  });
  var coveredAreas = {};

  // 후보별 활동 영역
  competitors.forEach(function(comp) {
    var pc = getPartyColor(comp.party);
    if (comp.mainAreas) {
      comp.mainAreas.forEach(function(area) {
        coveredAreas[area] = (coveredAreas[area] || 0) + 1;
        var center = getAreaCenter(area);
        var isSelected = selectedCompetitorId === comp.id;

        // 활동 영역 원
        var circle = L.circle([center.lat, center.lng], {
          radius: isSelected ? 1200 : 900,
          color: comp.color || pc.color,
          fillColor: comp.color || pc.color,
          fillOpacity: isSelected ? 0.25 : 0.12,
          weight: isSelected ? 3 : 2
        }).addTo(competitorMap);
        circle.bindPopup(
          '<div class="text-sm">' +
          '<p class="font-bold">' + comp.name + '</p>' +
          '<p class="party-badge" style="background:' + pc.color + '20;color:' + pc.color + '">' + comp.party + '</p>' +
          '<p class="mt-1 text-gray-500">활동 지역: ' + area + '</p>' +
          '</div>'
        );
        mapLayers.push(circle);

        // 이름 표시
        var label = L.marker([center.lat + 0.003, center.lng], {
          icon: L.divIcon({
            className: 'comp-label',
            html: '<div style="background:' + (comp.color || pc.color) + ';color:white;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:700;white-space:nowrap;box-shadow:0 1px 4px rgba(0,0,0,0.2)">' + comp.name + '</div>',
            iconSize: [80, 24],
            iconAnchor: [40, 12]
          })
        }).addTo(competitorMap);
        mapLayers.push(label);
      });
    }
  });

  // 공백 지역 표시 (후보가 없는 지역)
  allAreas.forEach(function(d) {
    if (!coveredAreas[d.dong] || coveredAreas[d.dong] === 0) {
      var gapCircle = L.circle([d.lat, d.lng], {
        radius: 800,
        color: '#059669',
        fillColor: '#059669',
        fillOpacity: 0.15,
        weight: 2,
        dashArray: '8,4'
      }).addTo(competitorMap);
      gapCircle.bindPopup(
        '<div class="text-sm">' +
        '<p class="font-bold text-green-700">공백 지역</p>' +
        '<p class="text-gray-600">' + d.dong + '</p>' +
        '<p class="text-xs text-green-600 mt-1">경쟁 후보가 적은 지역입니다.<br>유세 전략적 기회!</p>' +
        '</div>'
      );
      mapLayers.push(gapCircle);

      var gapLabel = L.marker([d.lat - 0.004, d.lng], {
        icon: L.divIcon({
          className: 'gap-label',
          html: '<div style="background:#059669;color:white;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:700;white-space:nowrap;box-shadow:0 1px 4px rgba(0,0,0,0.2)">공백: ' + d.dong + '</div>',
          iconSize: [100, 24],
          iconAnchor: [50, 12]
        })
      }).addTo(competitorMap);
      mapLayers.push(gapLabel);
    } else if (coveredAreas[d.dong] >= 2) {
      // 경쟁 과열 지역
      var hotCircle = L.circle([d.lat, d.lng], {
        radius: 600,
        color: '#dc2626',
        fillColor: '#dc2626',
        fillOpacity: 0.08,
        weight: 1,
        dashArray: '4,4'
      }).addTo(competitorMap);
      hotCircle.bindPopup(
        '<div class="text-sm">' +
        '<p class="font-bold text-red-600">경쟁 과열 지역</p>' +
        '<p class="text-gray-600">' + d.dong + ' (' + coveredAreas[d.dong] + '명 활동)</p>' +
        '<p class="text-xs text-red-500 mt-1">차별화 전략이 필요합니다.</p>' +
        '</div>'
      );
      mapLayers.push(hotCircle);
    }
  });
}

/* ── 후보 역량 비교 레이더 ── */
function updateCompareRadar() {
  var labels = ['조직력', 'SNS/미디어', '정책 전문성', '인지도', '지역 기반'];

  // 각 후보별 역량 점수 시뮬레이션
  var datasets = competitors.map(function(comp, idx) {
    var pc = getPartyColor(comp.party);
    // 강점/약점으로 점수 생성
    var scores = generateCompScores(comp);
    return {
      label: comp.name,
      data: scores,
      backgroundColor: (comp.color || pc.color) + '20',
      borderColor: comp.color || pc.color,
      borderWidth: 2,
      pointBackgroundColor: comp.color || pc.color,
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
      pointRadius: 4
    };
  });

  if (compareRadarChart) compareRadarChart.destroy();

  compareRadarChart = new Chart(document.getElementById('compare-radar'), {
    type: 'radar',
    data: { labels: labels, datasets: datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        r: {
          beginAtZero: true,
          max: 100,
          ticks: { stepSize: 20, font: { size: 10 } },
          pointLabels: { font: { size: 11, family: "'Pretendard Variable',sans-serif" } },
          grid: { color: '#e2e8f0' }
        }
      },
      plugins: {
        legend: { position: 'bottom', labels: { font: { size: 11 }, padding: 12 } }
      }
    }
  });
}

/* ── 후보 역량 점수 생성 ── */
function generateCompScores(comp) {
  // 조직력, SNS/미디어, 정책, 인지도, 지역기반
  var baseScores = [55, 55, 55, 55, 55];

  // 강점 반영
  var strengthMap = {
    '조직력': 0, 'SNS': 1, '미디어': 1, '정책력': 2, '인지도': 3, '지역 기반': 4, '참신함': 1, '신규': 2
  };
  (comp.strength || []).forEach(function(s) {
    var idx = strengthMap[s];
    if (idx !== undefined) baseScores[idx] = Math.min(95, baseScores[idx] + 25);
    else {
      var ri = Math.floor(Math.random() * 5);
      baseScores[ri] = Math.min(90, baseScores[ri] + 15);
    }
  });

  // 약점 반영
  var weaknessMap = {
    '젊은층 약세': 1, '지역 기반 약세': 4, '조직 부족': 0, '분석 중': -1
  };
  (comp.weakness || []).forEach(function(w) {
    var idx = weaknessMap[w];
    if (idx !== undefined && idx >= 0) baseScores[idx] = Math.max(25, baseScores[idx] - 20);
  });

  // 정당별 보정
  if (comp.party === '더불어민주당') { baseScores[0] += 10; baseScores[4] += 5; }
  if (comp.party === '국민의힘') { baseScores[2] += 5; baseScores[3] += 10; }
  if (comp.party === '무소속') { baseScores[1] += 10; }

  // 약간의 랜덤 변동
  return baseScores.map(function(s) {
    return Math.min(100, Math.max(20, Math.round(s + (Math.random() * 10 - 5))));
  });
}

/* ── 시간대별 유세 활동 차트 ── */
function updateTimeChart() {
  var hours = [];
  for (var h = 6; h <= 22; h++) hours.push(h + ':00');

  var datasets = competitors.map(function(comp) {
    var pc = getPartyColor(comp.party);
    // 역세권+아파트단지 혼합 패턴 기반 추정
    var pattern = [];
    for (var hh = 6; hh <= 22; hh++) {
      var stationVal = TIME_PATTERNS['역세권'][hh] || 0.3;
      var aptVal = TIME_PATTERNS['아파트단지'][hh] || 0.3;
      var val = (stationVal * 0.6 + aptVal * 0.4) * 100;

      // 후보별 특성 반영
      if (comp.strength && comp.strength.indexOf('조직력') >= 0) val *= 1.1;
      if (comp.strength && comp.strength.indexOf('SNS') >= 0 && hh >= 18) val *= 1.2;

      pattern.push(Math.round(Math.min(100, val + (Math.random() * 10 - 5))));
    }
    return {
      label: comp.name,
      data: pattern,
      borderColor: comp.color || pc.color,
      bgColor: (comp.color || pc.color) + '15',
      fill: false,
      pointRadius: 2
    };
  });

  if (timeChart) timeChart.destroy();
  timeChart = createLineChart(document.getElementById('time-chart'), hours, datasets);
}

/* ── AI 전략 추천 ── */
function updateStrategy() {
  // 공백 지역 계산
  var suwonAreas = ['장안구', '권선구', '팔달구', '영통구'];
  var coveredAreas = {};
  competitors.forEach(function(c) {
    (c.mainAreas || []).forEach(function(a) { coveredAreas[a] = (coveredAreas[a] || 0) + 1; });
  });
  var gapAreas = suwonAreas.filter(function(a) { return !coveredAreas[a]; });
  var hotAreas = suwonAreas.filter(function(a) { return coveredAreas[a] >= 2; });

  // 가장 강한 후보
  var strongestCompetitor = competitors[0];

  var strategies = [
    {
      icon: '<svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/></svg>',
      title: '공백 지역 공략',
      content: gapAreas.length > 0
        ? '<strong>' + gapAreas.join(', ') + '</strong> 지역에 경쟁 후보의 활동이 부재합니다. 해당 지역에 유세 차량을 우선 배치하여 선점 효과를 극대화하세요.'
        : '모든 주요 지역에 경쟁 후보가 활동 중입니다. 시간대별 차별화 전략이 필요합니다.',
      priority: gapAreas.length > 0 ? '높음' : '보통',
      priorityColor: gapAreas.length > 0 ? 'text-red-600 bg-red-50' : 'text-yellow-600 bg-yellow-50'
    },
    {
      icon: '<svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
      title: '시간대 차별화',
      content: '경쟁 후보들의 출근 시간대(07-09시) 유세 집중이 예상됩니다. <strong>점심(11-13시)과 저녁(17-19시)</strong> 시간대에 주요 거점을 공략하면 유권자 접촉 효율이 높아집니다.',
      priority: '높음',
      priorityColor: 'text-red-600 bg-red-50'
    },
    {
      icon: '<svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>',
      title: '경쟁 우위 전략',
      content: strongestCompetitor
        ? '<strong>' + strongestCompetitor.name + '</strong> 후보의 약점인 ' + (strongestCompetitor.weakness ? '<strong>' + strongestCompetitor.weakness.join(', ') + '</strong>' : '미확인 영역') + '을 타겟팅하세요. 해당 분야에서 차별화된 메시지를 전달하면 효과적입니다.'
        : '경쟁 후보 정보를 추가하면 맞춤 전략이 생성됩니다.',
      priority: '보통',
      priorityColor: 'text-yellow-600 bg-yellow-50'
    },
    {
      icon: '<svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>',
      title: '연령층 맞춤 전략',
      content: hotAreas.length > 0
        ? '경쟁이 치열한 <strong>' + hotAreas.join(', ') + '</strong> 지역에서는 30-40대 젊은 유권자층에 집중하세요. SNS 및 현장 이벤트를 병행하면 인지도 제고에 효과적입니다.'
        : '각 지역 연령 분포에 맞춘 맞춤형 메시지 전략을 수립하세요. 20-30대는 SNS, 50-60대는 현장 유세에 집중하는 것을 권장합니다.',
      priority: '보통',
      priorityColor: 'text-yellow-600 bg-yellow-50'
    },
    {
      icon: '<svg class="w-5 h-5 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>',
      title: '차량 운영 제안',
      content: '현재 경쟁 후보 <strong>' + competitors.length + '명</strong> 분석 결과, 차량 <strong>' + Math.min(4, competitors.length + 1) + '대</strong> 운영을 권장합니다. 주요 거점 순환 경로를 설정하고, 1대는 공백 지역 전담으로 배치하세요.',
      priority: '낮음',
      priorityColor: 'text-green-600 bg-green-50'
    }
  ];

  document.getElementById('strategy-panel').innerHTML = strategies.map(function(s) {
    return '<div class="strategy-card">' +
      '<div class="flex items-start gap-3">' +
      '<div class="shrink-0 mt-0.5">' + s.icon + '</div>' +
      '<div class="min-w-0">' +
      '<div class="flex items-center gap-2 mb-1">' +
      '<span class="font-bold text-sm text-gray-800">' + s.title + '</span>' +
      '<span class="text-[10px] font-bold px-2 py-0.5 rounded-full ' + s.priorityColor + '">우선순위: ' + s.priority + '</span>' +
      '</div>' +
      '<p class="text-xs text-gray-600 leading-relaxed">' + s.content + '</p>' +
      '</div></div></div>';
  }).join('');
}
</script>
</body>
</html>
